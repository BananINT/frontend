<div class="min-h-screen bg-gradient-to-br from-yellow-400 via-yellow-300 to-orange-400">
    <!-- Header -->
    <header class="bg-yellow-900 shadow-lg">
        <div class="container mx-auto px-4 py-4">
        <div class="flex flex-col md:flex-row items-center justify-between">
            <a 
                routerLink="/"
                class="bg-yellow-900 text-yellow-100 px-6 py-3 rounded-full font-bold hover:bg-yellow-800 transition-all transform hover:scale-105 flex items-center gap-2"
            >
                ğŸšª Retour
            </a>
            <h1 class="text-3xl font-bold text-yellow-100">ğŸŒ BananINT Clicker ğŸŒ</h1>
        </div>
        </div>
    </header>

    @if (gameService.loading()) {
    <div class="container mx-auto px-4 py-16">
        <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-12 max-w-2xl mx-auto text-center">
        <div class="text-6xl animate-bounce mb-6">ğŸŒ</div>
        <p class="text-2xl font-bold text-yellow-900">Loading your banana empire...</p>
        </div>
    </div>
    } @else if (gameService.error()) {
    <div class="container mx-auto px-4 py-16">
        <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-12 max-w-2xl mx-auto text-center">
            <div class="text-6xl mb-6">âš ï¸</div>
            <p class="text-2xl font-bold text-yellow-900">Something went wrong.</p>
        </div>
    </div>
    } @else {
    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <div class="grid lg:grid-cols-3 gap-8">
        
        <!-- Left Column - Stats & Clicker -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-white/90 backdrop-blur rounded-2xl shadow-xl p-6 text-center transform hover:scale-105 transition-all">
                <div class="text-3xl font-bold text-yellow-600">{{ formatNumber(gameService.gameState().bananas) }}</div>
                <div class="text-sm text-yellow-900 mt-1">ğŸŒ Bananas</div>
            </div>
            
            <div class="bg-white/90 backdrop-blur rounded-2xl shadow-xl p-6 text-center transform hover:scale-105 transition-all">
                <div class="text-3xl font-bold text-yellow-600">{{ gameService.gameState().bananasPerClick }}</div>
                <div class="text-sm text-yellow-900 mt-1">ğŸ‘† Per Click</div>
            </div>
            
            @if (gameService.totalBananasPerSecond() > 0) {
                <div class="bg-gradient-to-br from-yellow-400 to-orange-400 rounded-2xl shadow-xl p-6 text-center transform hover:scale-105 transition-all">
                <div class="text-3xl font-bold text-white">{{ formatNumber(gameService.totalBananasPerSecond()) }}</div>
                <div class="text-sm text-white mt-1">âš™ï¸ Per Second</div>
                </div>
            }
            
            <div class="bg-white/90 backdrop-blur rounded-2xl shadow-xl p-6 text-center transform hover:scale-105 transition-all">
                <div class="text-3xl font-bold text-yellow-600">{{ formatNumber(gameService.gameState().totalClicks) }}</div>
                <div class="text-sm text-yellow-900 mt-1">ğŸ¯ Total Clicks</div>
            </div>
            </div>

            <!-- Clicker Area -->
            <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-12">
            <div class="flex flex-col items-center justify-center">
                <div class="relative">
                <button
                    (click)="onBananaClick()"
                    [disabled]="gameService.clickCooldown()"
                    [class.opacity-60]="gameService.clickCooldown()"
                    [class.cursor-not-allowed]="gameService.clickCooldown()"
                    class="relative w-64 h-64 rounded-full bg-gradient-to-br from-yellow-400 to-yellow-500 shadow-2xl hover:shadow-3xl transition-all transform hover:scale-105 active:scale-95 flex items-center justify-center text-9xl disabled:hover:scale-100">
                    ğŸŒ
                    
                    @if (clickAnimation()) {
                    <div class="absolute -top-12 left-1/2 transform -translate-x-1/2 text-3xl font-bold text-yellow-600 animate-float-up pointer-events-none">
                        +{{ gameService.gameState().bananasPerClick }}
                    </div>
                    }
                </button>
                </div>
                
                <p class="mt-6 text-xl text-yellow-900 font-semibold">
                Clique sur la banane !
                </p>
            </div>
            </div>

            <!-- Upgrades Section -->
            <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-3xl font-bold text-yellow-900">ğŸª Shop d'Upgrades</h2>
            </div>
            
            <!-- Upgrade Tabs -->
            <div class="flex gap-2 mb-6">
                <button 
                (click)="upgradeFilter.set('all')"
                [class]="upgradeFilter() === 'all' ? 'bg-yellow-500 text-white' : 'bg-yellow-100 text-yellow-900'"
                class="flex-1 px-4 py-3 rounded-xl font-bold transition-all hover:bg-yellow-400">
                Tous
                </button>
                <button 
                (click)="upgradeFilter.set('click')"
                [class]="upgradeFilter() === 'click' ? 'bg-yellow-500 text-white' : 'bg-yellow-100 text-yellow-900'"
                class="flex-1 px-4 py-3 rounded-xl font-bold transition-all hover:bg-yellow-400">
                ğŸ‘† Click
                </button>
                <button 
                (click)="upgradeFilter.set('auto')"
                [class]="upgradeFilter() === 'auto' ? 'bg-yellow-500 text-white' : 'bg-yellow-100 text-yellow-900'"
                class="flex-1 px-4 py-3 rounded-xl font-bold transition-all hover:bg-yellow-400">
                âš™ï¸ Auto
                </button>
            </div>

            <!-- Upgrades Grid -->
            <div class="grid md:grid-cols-2 gap-4 max-h-[600px] overflow-y-auto pr-2">
                @for (upgrade of filteredUpgrades(); track upgrade.id) {
                <div 
                    [class]="canAfford(upgrade) ? 'border-green-500 bg-green-50' : 'border-yellow-200 bg-white'"
                    class="border-2 rounded-2xl p-5 transition-all hover:shadow-lg">
                    
                    <div class="flex items-start justify-between mb-3">
                    <div>
                        <h3 class="text-lg font-bold text-yellow-900">{{ upgrade.name }}</h3>
                        @if (upgrade.type === 'click') {
                        <p class="text-sm text-yellow-700">ğŸ‘† +{{ upgrade.multiplier }} par clic</p>
                        } @else {
                        <p class="text-sm text-yellow-700">âš™ï¸ +{{ upgrade.multiplier }}/sec</p>
                        }
                    </div>
                    
                    @if (upgrade.owned > 0) {
                        <span class="bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                        Ã—{{ upgrade.owned }}
                        </span>
                    }
                    </div>
                    
                    <div class="flex items-center justify-between">
                    <div class="text-lg font-bold text-yellow-900">
                        {{ formatNumber(getCost(upgrade)) }} ğŸŒ
                    </div>
                    
                    <button
                        (click)="buyUpgrade(upgrade)"
                        [disabled]="!canAfford(upgrade) || isBuying()"
                        class="bg-yellow-500 hover:bg-yellow-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-6 py-2 rounded-full font-bold transition-all transform hover:scale-105 active:scale-95">
                        @if (isBuying()) {
                        <span>...</span>
                        } @else {
                        <span>Acheter</span>
                        }
                    </button>
                    </div>
                </div>
                }
            </div>
            </div>
        </div>

        <!-- Right Column - Leaderboard -->
        <div class="space-y-6">
            
            <!-- Leaderboard -->
            <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-8">
            <h2 class="text-3xl font-bold text-yellow-900 mb-6 text-center">ğŸ† Leaderboard</h2>
            
            @if (gameService.leaderboard().length === 0) {
                <div class="text-center py-12">
                <div class="text-6xl mb-4">ğŸŒ</div>
                <p class="text-yellow-700">Aucun score pour le moment</p>
                <p class="text-sm text-yellow-600 mt-2">Sois le premier !</p>
                </div>
            } @else {
                <div class="space-y-3 mb-6">
                @for (entry of gameService.leaderboard(); track $index) {
                    <div 
                    [class]="$index === 0 ? 'bg-gradient-to-r from-yellow-400 to-orange-400' : 'bg-yellow-50'"
                    class="rounded-xl p-4 flex items-center gap-3 transition-all hover:shadow-md">
                    <div class="text-2xl font-bold w-8">
                        @if ($index === 0) {
                        ğŸ¥‡
                        } @else if ($index === 1) {
                        ğŸ¥ˆ
                        } @else if ($index === 2) {
                        ğŸ¥‰
                        } @else {
                        <span class="text-yellow-700">{{ $index + 1 }}</span>
                        }
                    </div>
                    <div class="flex-1 min-w-0">
                        <div [class]="$index === 0 ? 'text-white' : 'text-yellow-900'" 
                            class="font-bold truncate">
                        {{ entry.name }}
                        </div>
                    </div>
                    <div [class]="$index === 0 ? 'text-white' : 'text-yellow-600'" 
                            class="font-bold text-lg">
                        {{ formatNumber(entry.score) }}
                    </div>
                    </div>
                }
                </div>
            }
            
            <!-- Submit Score Form -->
            <div class="border-t-2 border-yellow-200 pt-6 space-y-3">
                <input
                type="text"
                [(ngModel)]="playerName"
                placeholder="Ton nom"
                maxlength="20"
                class="w-full px-4 py-3 rounded-xl border-2 border-yellow-200 focus:border-yellow-500 focus:outline-none font-medium">
                
                <button
                (click)="submitScore()"
                [disabled]="!playerName.trim() || isSubmitting()"
                class="w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-6 py-3 rounded-xl font-bold transition-all transform hover:scale-105 active:scale-95">
                @if (isSubmitting()) {
                    <span>Envoi en cours...</span>
                } @else {
                    <span>ğŸ“¤ Soumettre mon score</span>
                }
                </button>
            </div>
            </div>

            <!-- Actions -->
            <div class="bg-white/90 backdrop-blur rounded-3xl shadow-2xl p-6">
            <button
                (click)="openSessionModal()"
                class="w-full bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-xl font-bold transition-all transform hover:scale-105 active:scale-95">
                ğŸ”‘ Session
            </button>
            </div>
        </div>
        </div>
    </div>
    }

    <!-- Welcome Back Modal -->
    @if (showWelcomeBack()) {
    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" (click)="showWelcomeBack.set(false)">
        <div class="bg-gradient-to-br from-yellow-400 to-orange-400 rounded-3xl shadow-2xl p-8 max-w-md w-full" (click)="$event.stopPropagation()">
        <div class="text-center">
            <div class="text-7xl mb-4 animate-bounce">ğŸ‰</div>
            <h2 class="text-3xl font-bold text-white mb-4">Bon retour !</h2>
            <p class="text-white text-lg mb-2">
            Tu as gagnÃ© pendant ton absence :
            </p>
            <p class="text-5xl font-bold text-white mb-6">
            {{ formatNumber(offlineEarnings()) }} ğŸŒ
            </p>
            <button
            (click)="showWelcomeBack.set(false)"
            class="bg-white text-yellow-900 px-8 py-3 rounded-full font-bold text-lg hover:bg-yellow-50 transition-all transform hover:scale-105">
            GÃ©nial ! ğŸš€
            </button>
        </div>
        </div>
    </div>
    }

    <!-- Session Management Modal -->
    @if (showSessionModal()) {
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" (click)="showSessionModal.set(false)">
            <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-lg w-full max-h-[90vh] overflow-y-auto" (click)="$event.stopPropagation()">
                <h3 class="text-3xl font-bold text-yellow-900 mb-6 flex items-center gap-3">
                    ğŸ”‘ Gestion de Session
                </h3>

                <!-- Current Session -->
                <div class="mb-6">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        Session Actuelle
                    </label>
                    <div class="flex gap-2">
                        <input
                            type="text"
                            [value]="currentSessionId()"
                            readonly
                            class="flex-1 px-4 py-3 rounded-xl border-2 border-gray-300 bg-gray-50 font-mono text-sm">
                        <button
                            (click)="copySessionId()"
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-xl font-bold transition-all">
                            ğŸ“‹
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">
                        Cette session est automatiquement synchronisÃ©e avec le serveur
                    </p>
                </div>

                <!-- Change Session -->
                <div class="mb-6">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        Charger une Session Existante
                    </label>
                    <input
                        type="text"
                        [(ngModel)]="newSessionId"
                        placeholder="Collez un ID de session existant"
                        class="w-full px-4 py-3 rounded-xl border-2 border-yellow-200 focus:border-yellow-500 focus:outline-none font-mono text-sm mb-2">
                    <p class="bg-orange-50 border-2 border-orange-200 rounded-xl p-4 text-sm font-bold text-red-600">
                        âš ï¸ Vous perdrez votre progression sur la session actuelle si vous n'en sauvegardez pas l'ID !
                    </p>
                </div>

                <!-- Actions -->
                <div class="space-y-3">
                    <button
                        (click)="changeSession()"
                        [disabled]="!newSessionId.trim()"
                        class="w-full bg-purple-500 hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-6 py-3 rounded-xl font-bold transition-all">
                        Charger cette Session
                    </button>
                    
                    <button
                        (click)="showSessionModal.set(false)"
                        class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-xl font-bold transition-all">
                        Annuler
                    </button>
                </div>

                <!-- Info Box -->
                <div class="mt-6 bg-blue-50 border-2 border-blue-200 rounded-xl p-4 text-sm text-blue-900">
                    <p class="font-bold mb-1">â„¹ï¸ Comment Ã§a marche ?</p>
                    <p>Une session correspond Ã  une partie sauvegardÃ©e sur le serveur. Il suffit d'avoir l'ID de session pour accÃ¨s Ã  la partie.</p>
                </div>
            </div>
        </div>
    }

    <!-- Footer -->
    <footer class="bg-yellow-900 text-yellow-100 py-6 mt-12">
    <div class="container mx-auto px-4 text-center">
        <p class="text-lg">ğŸŒ BananINT Clicker ğŸŒ</p>
        <p class="mt-2 text-sm text-yellow-200">Farm des bananes, deviens riche !</p>
    </div>
    </footer>
</div>